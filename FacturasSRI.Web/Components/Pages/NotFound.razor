@page "/notfound"
@inject NavigationManager Navigation
@using Microsoft.AspNetCore.Components.Authorization
@inject AuthenticationStateProvider AuthenticationStateProvider

<PageTitle>Página no encontrada (404)</PageTitle>

<div class="text-center mt-5">
    <h1 class="display-1 fw-bold">404</h1>
    <p class="fs-3"> <span class="text-danger">¡Ups!</span> Página no encontrada.</p>
    <p class="lead">
        La página que estás buscando no existe.
    </p>
    <p class="text-muted small mt-4">
        La URL solicitada: <code>@attemptedUrl</code> no fue encontrada en el servidor.
    </p>
    <a href="@homeUrl" class="btn btn-primary mt-3">@buttonText</a>
</div>

@code {
    private string attemptedUrl = string.Empty;
    private string homeUrl = "/";
    private string buttonText = "Volver al Inicio";

    protected override async Task OnInitializedAsync()
    {
        var absoluteUri = new Uri(Navigation.Uri);
        attemptedUrl = absoluteUri.PathAndQuery;

        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;

        if (user.Identity != null && user.Identity.IsAuthenticated)
        {
            if (user.HasClaim("UserType", "Cliente"))
            {
                homeUrl = "/cliente/dashboard";
                buttonText = "Volver a Mi Panel";
            }
            else if (user.IsInRole("Administrador") || user.IsInRole("Vendedor") || user.IsInRole("Bodeguero"))
            {
                homeUrl = "/dashboard";
                buttonText = "Volver al Panel Principal";
            }
        }
    }
}